<!DOCTYPE html><html><head><meta charset="utf-8"><title>FileSystem.md</title><link rel="stylesheet" type="text/css" href="style.css"></head><body id="preview">
<h1><a id="FileSystem_0"></a>FileSystem</h1>
<p>Master class for TAJ-FS. Describes a Unix-like file system for ThreadOS.</p>
<h2><a id="private_SuperBlock_superblock_2"></a>private SuperBlock superblock</h2>
<p>The SuperBlock for this FileSystem. See <a href="SuperBlock.md.html">SuperBlock</a>.</p>
<h2><a id="private_Directory_root_4"></a>private Directory root</h2>
<p>The root Directory for this FileSystem. See <a href="Directory.md.html">Directory</a>.</p>
<h2><a id="private_FileTable_fileTable_6"></a>private FileTable fileTable</h2>
<p>The FileTable for this FileSystem. See <a href="FileTable.md.html">FileTable</a>.</p>
<h2>private static final int SEEK_SET = 0</h2>
<h2>private static final int SEEK_CUR = 1</h2>
<h2>private static final int SEEK_END = 2</h2>
<h2><a id="public_FileSystemint_diskBlocks_8"></a>public FileSystem(int diskBlocks)</h2>
<p>Construct a FileSystem with the given number of blocks; initializes superblock, root, and fileTable; and reconstructs directory information from disk if present.</p>
<h2><a id="void_sync_10"></a>void sync()</h2>
<p>Synchronize file system to disk.</p>
<h2><a id="boolean_formatint_maxFiles_12"></a>boolean format(int maxFiles)</h2>
<p>Format the disk with the given maximum number of file inodes. Return 0 on success, -1 on failure.</p>
<h2><a id="FileTableEntry_openString_fileName_String_mode_14"></a>FileTableEntry open(String fileName, String mode)</h2>
<p>Open the specified file in the given mode (“r”: Read, “w”: Write, “w+”: Read/Write, “a”: Append) and set the seek pointer to the appropriate location (0 for “r”/“w”/“w+”, EOF for “a”).<br>
Returns an integer file descriptor for the file. If the file does not exist under “w”/“w+”/“a” modes, create it. If the file does not exist under “a” mode, return -1. If the calling thread’s file descriptor table is full, return -2.<br>
Note: File descriptors returned must be &gt; 2, so as not to overlap standard I/O.<br>
Returns null on failure.</p>
<h2><a id="boolean_closeFileTableEntry_fte_19"></a>boolean close(FileTableEntry fte)</h2>
<p>Close the given file, commit all file transactions, unregister file from calling thread’s file descriptor table.<br>
Returns 0 on success, -1 on failure.</p>
<h2><a id="int_fteSizeFileTableEntry_fte_22"></a>int fteSize(FileTableEntry fte)</h2>
<p>Return the size in bytes of the given file.</p>
<h2><a id="int_deleteString_fileName_24"></a>int delete(String fileName)</h2>
<p>Delete the specified file. All blocks used by the file are freed. <em>Open files may not be deleted.</em><br>
Returns 0 on success, -1 if file is open.</p>
<h2><a id="int_readFileTableEntry_fte_byte_buffer_27"></a>int read(FileTableEntry fte, byte[] buffer)</h2>
<p>Read <strong>up to</strong> <code>buffer.length()</code> bytes from the given file into the given buffer, starting at the seek pointer, ending at EOF if less than the buffer length. Increments the seek pointer by the number of bytes read.<br>
Returns the number of read bytes or -1 on failure.</p>
<h2><a id="int_writeFileTableEntry_fte_byte_buffer_30"></a>int write(FileTableEntry fte, byte[] buffer)</h2>
<p>Write the contents of the given buffer to the given file, starting at the seek pointer. <strong>This operation may overwrite and/or append</strong>. Increments the seek pointer by the number of bytes written.<br>
Returns the number of bytes written or -1 on failure.</p>
<h2>public int writeToTheDisk(FileTableEntry fte, byte[] buffer)</h2>
<p>Helper for write.</p>
<h2><a id="int_seekFileTableEntry_fte_int_offset_int_origin_33"></a>int seek(FileTableEntry fte, int offset, int origin)</h2>
<p>Offset may be positive or negative. Origin must be within {0, 1, 2}.<br>
Update the seek pointer based on the given offset and origin:</p>
<ul>
<li>If origin = 0: seek pointer is moved to the beginning of the file + offset</li>
<li>If origin = 1: seek pointer is moved to its current value + offset</li>
<li>If origin = 2: seek pointer is moved to the size of the file + offset</li>
</ul>
<p><em>If the given origin and offset would make the seek pointer negative, the seek pointer is set to 0.</em><br>
<em>If the given origin and offset would make the seek pointer greater than EOF, the seek pointer is set to EOF.</em><br>
Returns 0 for all above cases, -1 on failure.</p>
<h2><a id="private_boolean_deallocateAllBlocksFileTableEntry_fte_43"></a>private boolean deallocateAllBlocks(FileTableEntry fte)</h2>
<p>Deallocate all blocks in the given FTE, setting their references to -1.</p>
<h2>private void returnAllBlocks(byte[] data)</h2>
<p>Return blocks referenced by the given byte[].</p>
<h2>private void deallocate(FileTableEntry files)</h2>
<p>Deallocate all direct blocks in the given FTE.</p>

</body></html>